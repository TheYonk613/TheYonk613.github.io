<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Drum Notation Generator - Younker Studio</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Interactive drum notation generator - Convert drum notation to professional sheet music. Built with modern web technologies." />
	<meta name="keywords" content="drum notation, sheet music, music generator, interactive tool, Netanel Younker, Younker Studio" />
	<meta name="author" content="Netanel Moshe Younker" />

	<!-- 
	//////////////////////////////////////////////////////

	Younker Studio - Professional Portfolio & Resume
	DESIGNED & DEVELOPED by Netanel Moshe Younker
		
	Website: 		https://theyonk613.github.io
	Email: 			Netanelyounker@gmail.com
	LinkedIn: 		https://linkedin.com/in/netanel-younker

	//////////////////////////////////////////////////////
	 -->

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content="Drum Notation Generator"/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content="Younker Studio"/>
	<meta property="og:description" content="Interactive drum notation generator - Convert drum notation to professional sheet music."/>
	<meta name="twitter:title" content="Drum Notation Generator" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="summary" />

	<link href="https://fonts.googleapis.com/css?family=Oxygen:300,400" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- VexFlow for music notation -->
	<script src="https://unpkg.com/vexflow@4.2.2/build/cjs/vexflow.js"></script>
	<script>
		// Check if VexFlow loaded
		window.addEventListener('load', function() {
			if (typeof VexFlow === 'undefined') {
				console.log('VexFlow failed to load, will use fallback rendering');
			} else {
				console.log('VexFlow loaded successfully');
			}
		});
	</script>

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	<style>
		.drum-tool-container {
			padding: 2rem 0;
			background: #f8f9fa;
		}
		
		.notation-input {
			background: white;
			border: 2px solid #e9ecef;
			border-radius: 8px;
			padding: 1.5rem;
			margin-bottom: 2rem;
			box-shadow: 0 2px 10px rgba(0,0,0,0.05);
		}
		
		.drum-grid-container {
			background: white;
			border: 2px solid #e9ecef;
			border-radius: 8px;
			padding: 1.5rem;
			margin-bottom: 2rem;
			overflow-x: auto;
		}
		
		.drum-grid {
			border-collapse: collapse;
			width: 100%;
			min-width: 600px;
		}
		
		.drum-grid th {
			background: #f8f9fa;
			border: 1px solid #dee2e6;
			padding: 0.75rem 0.5rem;
			text-align: center;
			font-weight: 600;
			font-size: 0.9rem;
			color: #495057;
		}
		
		.drum-grid td {
			border: 1px solid #dee2e6;
			padding: 0.5rem;
			text-align: center;
			cursor: pointer;
			transition: all 0.2s ease;
			min-width: 40px;
			height: 40px;
			vertical-align: middle;
		}
		
		.drum-grid td:hover {
			background: #e9ecef;
		}
		
		.drum-grid td.has-note {
			background: #66D37E;
			color: white;
			border-color: #66D37E;
			font-weight: bold;
		}
		
		.drum-grid td.drum-label {
			background: #f8f9fa;
			font-weight: 600;
			color: #495057;
			cursor: default;
			text-align: left;
			padding-left: 1rem;
		}
		
		.drum-grid td.drum-label:hover {
			background: #f8f9fa;
		}
		
		.time-signature-controls {
			background: white;
			border: 2px solid #e9ecef;
			border-radius: 8px;
			padding: 1.5rem;
			margin-bottom: 2rem;
		}
		
		.time-signature-controls h3 {
			margin-bottom: 1rem;
		}
		
		.time-signature-buttons {
			display: flex;
			gap: 1rem;
			flex-wrap: wrap;
		}
		
		.time-signature-btn {
			padding: 0.75rem 1.5rem;
			border: 2px solid #dee2e6;
			background: white;
			border-radius: 6px;
			cursor: pointer;
			transition: all 0.3s ease;
			font-weight: 600;
		}
		
		.time-signature-btn:hover {
			border-color: #66D37E;
			background: #f8fff9;
		}
		
		.time-signature-btn.active {
			background: #66D37E;
			color: white;
			border-color: #66D37E;
		}
		
		.generate-btn {
			background: linear-gradient(135deg, #66D37E 0%, #4CAF50 100%);
			border: none;
			color: white;
			padding: 1rem 2rem;
			border-radius: 8px;
			font-size: 1.1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(102, 211, 126, 0.3);
		}
		
		.generate-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(102, 211, 126, 0.4);
		}
		
		.sheet-music-output {
			background: white;
			border: 2px solid #e9ecef;
			border-radius: 8px;
			padding: 2rem;
			margin-top: 2rem;
			min-height: 300px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		
		.instructions {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 1.5rem;
			border-radius: 8px;
			margin-bottom: 2rem;
		}
		
		.instructions h3 {
			color: white;
			margin-bottom: 1rem;
		}
		
		.instructions ul {
			margin-bottom: 0;
		}
		
		.instructions li {
			margin-bottom: 0.5rem;
		}
		
		.vex-staff {
			background: white;
			border-radius: 4px;
			padding: 10px;
			margin: 10px 0;
		}
		
		.vex-staff svg {
			max-width: 100%;
			height: auto;
		}
	</style>

	</head>
	<body>
		
	<div class="fh5co-loader"></div>
	
	<div id="page">
	<nav class="fh5co-nav" role="navigation">
		<div class="container-wrap">
			<div class="top-menu">
				<div class="row">
					<div class="col-xs-2">
						<div id="fh5co-logo"><a href="index.html">Younker Studio</a></div>
					</div>
					<div class="col-xs-10 text-right menu-1">
						<ul>
							<li><a href="/">Home</a></li>
							<li class="active"><a href="/drums.html">Drums</a></li>
							<li><a href="/blog">Blog</a></li>
							<li><a href="/about">About</a></li>
							<li><a href="/resume">Resume</a></li>
							<li><a href="/contact">Contact</a></li>
						</ul>
					</div>
				</div>
				
			</div>
		</div>
	</nav>
	<div class="container-wrap">
		<aside id="fh5co-hero">
			<div class="flexslider">
				<ul class="slides">
			   	<li style="background-image: url(images/img_bg_1.jpg);">
			   		<div class="overlay-gradient"></div>
		   			<div class="row">
			   			<div class="col-md-6 col-md-offset-3 slider-text slider-text-bg">
			   				<div class="slider-text-inner text-center">
			   					<h1>Drum Notation Generator</h1>
										<h2>Convert Drum Notation to Professional Sheet Music</h2>
			   				</div>
			   			</div>
			   		</div>
			   	</li>		   	
			  	</ul>
		  	</div>
		</aside>		
		
		<div class="drum-tool-container">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<div class="instructions">
							<h3>How to Use the Drum Notation Generator</h3>
							<ul>
								<li><strong>Step 1:</strong> Select multiple drum notation symbols by clicking them (they'll turn red when selected)</li>
								<li><strong>Step 2:</strong> Use quick-select buttons for common instrument groups</li>
								<li><strong>Step 3:</strong> Click on measure grid cells to place all selected instruments at once</li>
								<li><strong>Step 4:</strong> Add multiple measures and repeat the process</li>
								<li><strong>Step 5:</strong> Click "Generate Sheet Music" to create your professional notation</li>
							</ul>
						</div>
					</div>
				</div>
				
				<div class="row">
					<div class="col-md-12">
						<div class="time-signature-controls">
							<h3>Time Signature & Beats</h3>
							<div class="time-signature-buttons">
								<button class="time-signature-btn active" data-beats="4" data-divisions="4">4/4 (4 beats)</button>
								<button class="time-signature-btn" data-beats="4" data-divisions="8">4/4 (8th notes)</button>
								<button class="time-signature-btn" data-beats="4" data-divisions="16">4/4 (16th notes)</button>
								<button class="time-signature-btn" data-beats="3" data-divisions="3">3/4 (3 beats)</button>
								<button class="time-signature-btn" data-beats="3" data-divisions="6">3/4 (6th notes)</button>
								<button class="time-signature-btn" data-beats="3" data-divisions="12">3/4 (12th notes)</button>
								<button class="time-signature-btn" data-beats="6" data-divisions="6">6/8 (6 beats)</button>
								<button class="time-signature-btn" data-beats="6" data-divisions="12">6/8 (12th notes)</button>
							</div>
						</div>
						
						<div class="drum-grid-container">
							<h3>Drum Grid - Click cells to add/remove notes</h3>
							<div id="drum-grid-wrapper">
								<!-- Drum grid will be generated here -->
							</div>
						</div>
						
						<div class="row">
							<div class="col-md-6">
								<button class="generate-btn" id="generate-sheet">Generate Sheet Music</button>
							</div>
							<div class="col-md-6">
								<div class="quick-patterns">
									<button class="btn btn-sm btn-outline-primary pattern-btn" data-pattern="basic-beat">Basic Beat</button>
									<button class="btn btn-sm btn-outline-primary pattern-btn" data-pattern="rock-beat">Rock Beat</button>
									<button class="btn btn-sm btn-outline-primary pattern-btn" data-pattern="jazz-beat">Jazz Beat</button>
									<button class="btn btn-sm btn-outline-primary pattern-btn" data-pattern="funk-beat">Funk Beat</button>
									<button class="btn btn-sm btn-outline-danger" id="clear-grid">Clear Grid</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="row">
					<div class="col-md-12">
						<div class="sheet-music-output" id="sheet-music-output">
							<div class="text-center">
								<h3>Your Sheet Music Will Appear Here</h3>
								<p>Click "Generate Sheet Music" to create your professional notation</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div><!-- END container-wrap -->

	<div class="container-wrap">
		<footer id="fh5co-footer" role="contentinfo">
			<div class="row">
				<div class="col-md-6 fh5co-widget">
					<h4>About Younker Studio</h4>
					<p>Professional with experience in team leadership, product management, and market research. Passionate about building innovative solutions and driving results through strategic planning and collaboration.</p>
				</div>

				<div class="col-md-3">
					<h4>Links</h4>
					<ul class="fh5co-footer-links">
						<li><a href="/">Home</a></li>
						<li><a href="/drums.html">Drums</a></li>
						<li><a href="/about">About</a></li>
						<li><a href="/resume">Resume</a></li>
						<li><a href="/contact">Contact</a></li>
					</ul>
				</div>

				<div class="col-md-3">
					<h4>Contact Information</h4>
					<ul class="fh5co-footer-links">
						<li>Jerusalem, Israel</li>
						<li><a href="tel:0556667791">(055) 666-7791</a></li>
						<li><a href="mailto:Netanelyounker@gmail.com">Netanelyounker@gmail.com</a></li>
						<li><a href="https://linkedin.com/in/netanel-younker">linkedin.com/in/netanel-younker</a></li>
					</ul>
				</div>

			</div>

			<div class="row copyright">
				<div class="col-md-12 text-center">
					<p>
						<small class="block">&copy; 2024 Younker Studio. All Rights Reserved.</small> 
						<small class="block">Professional Portfolio & Resume</small>
					</p>
					<p>
						<ul class="fh5co-social-icons">
							<li><a href="https://linkedin.com/in/netanel-younker"><i class="icon-linkedin"></i></a></li>
							<li><a href="mailto:Netanelyounker@gmail.com"><i class="icon-mail"></i></a></li>
						</ul>
					</p>
				</div>
			</div>
		</footer>
	</div>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up2"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Counters -->
	<script src="js/jquery.countTo.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>

	<script>
		$(document).ready(function() {
			let currentBeats = 4;
			let currentDivisions = 4;
			let drumData = {};
			
			// Drum instruments configuration
			const drumInstruments = [
				{ symbol: 'B', name: 'Bass Drum' },
				{ symbol: 'S', name: 'Snare' },
				{ symbol: 'H', name: 'Hi-Hat' },
				{ symbol: 'C', name: 'Crash' },
				{ symbol: 'R', name: 'Ride' },
				{ symbol: 'T', name: 'Tom 1' },
				{ symbol: 'M', name: 'Tom 2' },
				{ symbol: 'F', name: 'Floor Tom' },
				{ symbol: 'O', name: 'Open Hi-Hat' },
				{ symbol: 'X', name: 'Cross Stick' },
				{ symbol: 'P', name: 'Pedal Hi-Hat' },
				{ symbol: 'K', name: 'Kick' }
			];
			
			// Initialize the drum grid
			generateDrumGrid();
			
			// Time signature button clicks
			$('.time-signature-btn').click(function() {
				$('.time-signature-btn').removeClass('active');
				$(this).addClass('active');
				
				currentBeats = parseInt($(this).data('beats'));
				currentDivisions = parseInt($(this).data('divisions'));
				
				generateDrumGrid();
			});
			
			// Drum grid cell clicks
			$(document).on('click', '.drum-grid td:not(.drum-label)', function() {
				const drumSymbol = $(this).data('drum');
				const beatPosition = $(this).data('beat');
				const key = `${drumSymbol}-${beatPosition}`;
				
				if ($(this).hasClass('has-note')) {
					// Remove note
					$(this).removeClass('has-note').text('');
					delete drumData[key];
				} else {
					// Add note
					$(this).addClass('has-note').text(drumSymbol);
					drumData[key] = drumSymbol;
				}
			});
			
			// Clear grid
			$('#clear-grid').click(function() {
				$('.drum-grid td').removeClass('has-note').text('');
				drumData = {};
			});
			
			// Quick patterns
			$('.pattern-btn').click(function() {
				const pattern = $(this).data('pattern');
				applyPattern(pattern);
			});
			
			// Generate sheet music
			$('#generate-sheet').click(function() {
				console.log('Generating sheet music...');
				console.log('Drum data:', drumData);
				generateSheetMusic();
			});
			
			function generateDrumGrid() {
				const wrapper = $('#drum-grid-wrapper');
				wrapper.empty();
				
				// Create table
				const table = $('<table class="drum-grid"></table>');
				
				// Create header row with beat numbers
				const headerRow = $('<tr></tr>');
				headerRow.append('<th>Drum</th>'); // Empty corner cell
				
				for (let i = 0; i < currentDivisions; i++) {
					const beatLabel = getBeatLabel(i, currentBeats, currentDivisions);
					headerRow.append(`<th>${beatLabel}</th>`);
				}
				table.append(headerRow);
				
				// Create rows for each drum instrument
				drumInstruments.forEach(drum => {
					const row = $('<tr></tr>');
					row.append(`<td class="drum-label">${drum.name}</td>`);
					
					for (let i = 0; i < currentDivisions; i++) {
						const cell = $(`<td data-drum="${drum.symbol}" data-beat="${i}"></td>`);
						
						// Check if this cell has existing data
						const key = `${drum.symbol}-${i}`;
						if (drumData[key]) {
							cell.addClass('has-note').text(drum.symbol);
						}
						
						row.append(cell);
					}
					table.append(row);
				});
				
				wrapper.append(table);
			}
			
			function getBeatLabel(position, beats, divisions) {
				if (divisions === beats) {
					// Simple beat numbers (1, 2, 3, 4)
					return position + 1;
				} else if (divisions === beats * 2) {
					// 8th notes (1, &, 2, &, 3, &, 4, &)
					return position % 2 === 0 ? Math.floor(position / 2) + 1 : '&';
				} else if (divisions === beats * 4) {
					// 16th notes (1, e, &, a, 2, e, &, a, etc.)
					const beat = Math.floor(position / 4) + 1;
					const subdivision = position % 4;
					const labels = ['', 'e', '&', 'a'];
					return beat + labels[subdivision];
				} else if (divisions === beats * 2 && beats === 3) {
					// 6th notes for 3/4 (1, &, 2, &, 3, &)
					return position % 2 === 0 ? Math.floor(position / 2) + 1 : '&';
				} else if (divisions === beats * 4 && beats === 3) {
					// 12th notes for 3/4 (1, e, &, a, 2, e, &, a, 3, e, &, a)
					const beat = Math.floor(position / 4) + 1;
					const subdivision = position % 4;
					const labels = ['', 'e', '&', 'a'];
					return beat + labels[subdivision];
				} else if (divisions === beats && beats === 6) {
					// 6/8 time (1, 2, 3, 4, 5, 6)
					return position + 1;
				} else if (divisions === beats * 2 && beats === 6) {
					// 12th notes for 6/8 (1, &, 2, &, 3, &, 4, &, 5, &, 6, &)
					return position % 2 === 0 ? Math.floor(position / 2) + 1 : '&';
				}
				
				return position + 1; // Fallback
			}
			
			function applyPattern(pattern) {
				// Clear existing data
				drumData = {};
				$('.drum-grid td').removeClass('has-note').text('');
				
				let patternData;
				switch(pattern) {
					case 'basic-beat':
						patternData = {
							'B': [0, 4, 8, 12],
							'S': [4, 12],
							'H': [2, 6, 10, 14]
						};
						break;
					case 'rock-beat':
						patternData = {
							'B': [0, 4, 8, 12],
							'S': [4, 12],
							'H': [1, 3, 5, 7, 9, 11, 13, 15]
						};
						break;
					case 'jazz-beat':
						patternData = {
							'R': [0, 8],
							'S': [4, 12],
							'H': [2, 6, 10, 14]
						};
						break;
					case 'funk-beat':
						patternData = {
							'B': [0, 4, 8, 12],
							'S': [4, 12],
							'H': [1, 3, 5, 7, 9, 11, 13, 15],
							'C': [6]
						};
						break;
				}
				
				// Apply pattern to current grid
				Object.keys(patternData).forEach(drum => {
					patternData[drum].forEach(beat => {
						if (beat < currentDivisions) {
							const key = `${drum}-${beat}`;
							drumData[key] = drum;
							
							const cell = $(`.drum-grid td[data-drum="${drum}"][data-beat="${beat}"]`);
							cell.addClass('has-note').text(drum);
						}
					});
				});
			}
			
			function generateSheetMusic() {
				const measures = [];
				const notes = [];
				
				// Convert drum data to notes array
				Object.keys(drumData).forEach(key => {
					const [drum, beat] = key.split('-');
					notes.push({
						position: parseInt(beat),
						symbol: drum
					});
				});
				
				// Sort notes by position
				notes.sort((a, b) => a.position - b.position);
				
				measures.push({
					measure: 1,
					notes: notes,
					beats: currentBeats,
					divisions: currentDivisions
				});
				
				// Display the generated sheet music
				displaySheetMusic(measures);
			}
			
			function displaySheetMusic(measures) {
				console.log('Displaying sheet music for measures:', measures);
				
				let html = '<div class="text-center">';
				html += '<h3>Professional Drum Sheet Music</h3>';
				html += '<div class="sheet-music-display">';
				
				measures.forEach((measure, index) => {
					html += `<div class="measure-display" style="margin-bottom: 2rem;">`;
					html += `<h4>Measure ${measure.measure} (${measure.beats}/${measure.divisions})</h4>`;
					html += `<div class="staff-display" style="background: white; border: 2px solid #333; padding: 1rem; border-radius: 8px;">`;
					html += `<div id="staff-${index}" class="vex-staff"></div>`;
					html += '</div>';
					html += '</div>';
				});
				
				html += '</div>';
				html += '<div class="text-center mt-3">';
				html += '<button class="btn btn-primary" onclick="downloadSheetMusic()">Download PDF</button>';
				html += '<button class="btn btn-secondary ml-2" onclick="printSheetMusic()">Print</button>';
				html += '</div>';
				html += '</div>';
				
				$('#sheet-music-output').html(html);
				
				// Generate actual sheet music using VexFlow
				setTimeout(() => {
					console.log('Starting to render staffs...');
					measures.forEach((measure, index) => {
						console.log(`Rendering staff ${index}:`, measure);
						renderDrumStaff(measure, index);
					});
				}, 100);
			}
			
						function renderDrumStaff(measure, index) {
				console.log('Attempting to render staff', index, 'with measure:', measure);
				
				try {
					// Check if VexFlow is available
					if (typeof VexFlow === 'undefined') {
						console.log('VexFlow not loaded, using fallback');
						renderSimpleStaff(measure, index);
						return;
					}
					
					const { Vex } = VexFlow;
					const container = document.getElementById(`staff-${index}`);
					if (!container) {
						console.error('Container not found for staff', index);
						return;
					}
					
					// Clear container
					container.innerHTML = '';
					
					// Create renderer
					const renderer = new Vex.Flow.Renderer(container, Vex.Flow.Renderer.Backends.SVG);
					renderer.resize(800, 200);
					const context = renderer.getContext();
					
					// Create staff
					const staff = new Vex.Flow.Stave(10, 40, 780);
					staff.addClef('percussion');
					staff.addTimeSignature(`${measure.beats}/${measure.divisions}`);
					staff.setContext(context).draw();
					
					// Add ledger line for crash cymbal if needed
					const hasCrash = measure.notes.some(note => note.symbol === 'C');
					if (hasCrash) {
						const ledgerLine = new Vex.Flow.StaveLine(staff, {
							first_note: null,
							last_note: null,
							first_indices: [0],
							last_indices: [0]
						});
						ledgerLine.setContext(context);
						ledgerLine.setPosition(10, 30);
						ledgerLine.draw();
					}
					
					// Create simple notes
					const notes = [];
					const notePositions = {};
					
					// Group notes by position
					measure.notes.forEach(note => {
						if (!notePositions[note.position]) {
							notePositions[note.position] = [];
						}
						notePositions[note.position].push(note.symbol);
					});
					
					// Create notes for each position
					Object.keys(notePositions).forEach(position => {
						const symbols = notePositions[position];
						const timeValue = getTimeValue(measure.divisions, parseInt(position));
						
						// Create a simple note
						const noteKey = getDrumNoteKey(symbols[0]);
						const note = new Vex.Flow.StaveNote({
							clef: 'percussion',
							keys: [noteKey],
							duration: getDurationString(timeValue)
						});
						
						// Set note head style based on drum type
						const symbol = symbols[0];
						if (['C', 'R'].includes(symbol)) {
							// Cymbals - X note head
							note.setNoteHeadType(Vex.Flow.NoteHeadType.X);
						} else if (['H', 'O', 'P'].includes(symbol)) {
							// Hi-hats - triangle note head
							note.setNoteHeadType(Vex.Flow.NoteHeadType.TRIANGLE_DOWN);
						} else if (['X'].includes(symbol)) {
							// Cross stick - diamond note head
							note.setNoteHeadType(Vex.Flow.NoteHeadType.DIAMOND);
						} else {
							// Regular drums - normal filled note head
							note.setNoteHeadType(Vex.Flow.NoteHeadType.NORMAL);
						}
						
						note.setStemDirection(Vex.Flow.Stem.UP);
						notes.push(note);
					});
					
					// Create voice and draw
					if (notes.length > 0) {
						const voice = new Vex.Flow.Voice({time: {num_beats: measure.beats, beat_value: 4}});
						voice.addTickables(notes);
						
						// Create formatter
						const formatter = new Vex.Flow.Formatter();
						formatter.joinVoices([voice]);
						formatter.format([voice], 750);
						
						// Draw notes
						voice.draw(context, staff);
					}
					
					console.log('Successfully rendered staff', index);
					
				} catch (error) {
					console.error('Error rendering staff:', error);
					renderSimpleStaff(measure, index);
				}
			}
			
			function getDrumNoteKey(symbol) {
				// Standard drum notation positions following real sheet music conventions
				// Based on standard drum notation used in professional music
				const drumNotes = {
					'B': 'F/4', // Bass drum - bottom line (line 5)
					'S': 'C/5', // Snare drum - middle line (line 3)
					'H': 'G/5', // Hi-hat - top space (space 4)
					'C': 'C/6', // Crash cymbal - above staff (ledger line)
					'R': 'D/5', // Ride cymbal - top line (line 5)
					'T': 'E/5', // Tom 1 - second space from top (space 3)
					'M': 'F/5', // Tom 2 - top space (space 4)
					'F': 'A/4', // Floor tom - second line from bottom (line 2)
					'O': 'G/5', // Open hi-hat - top space (space 4)
					'X': 'C/5', // Cross stick - middle line (line 3)
					'P': 'G/5', // Pedal hi-hat - top space (space 4)
					'K': 'F/4'  // Kick - bottom line (line 5)
				};
				return drumNotes[symbol] || 'C/5';
			}
			
			function renderSimpleStaff(measure, index) {
				const container = document.getElementById(`staff-${index}`);
				if (!container) return;
				
				let html = '<div style="text-align: center; padding: 20px;">';
				html += '<div style="background: white; border: 2px solid #333; padding: 20px; border-radius: 8px; margin: 10px 0;">';
				
				// Create staff lines (5 lines for proper music staff)
				html += '<div style="position: relative; height: 120px; margin: 20px 0;">';
				
				// Draw 5 staff lines
				for (let i = 0; i < 5; i++) {
					const top = 20 + (i * 20);
					html += `<div style="position: absolute; left: 0; right: 0; top: ${top}px; height: 2px; background: #333;"></div>`;
				}
				
				// Add ledger line for crash cymbal if needed
				const hasCrash = measure.notes.some(note => note.symbol === 'C');
				if (hasCrash) {
					html += `<div style="position: absolute; left: 0; right: 0; top: 10px; height: 2px; background: #333;"></div>`;
				}
				
				// Add clef and time signature
				html += '<div style="position: absolute; left: 10px; top: 10px; font-size: 24px; font-weight: bold;">𝄀</div>';
				html += `<div style="position: absolute; left: 50px; top: 10px; font-size: 18px; font-weight: bold;">${measure.beats}/${measure.divisions}</div>`;
				
				// Add notes with stems and proper note head styles
				measure.notes.forEach(note => {
					const left = (note.position / measure.divisions) * 80 + 20; // 80% width + 20px offset
					const top = getNotePosition(note.symbol);
					
					// Note head style based on drum type (real sheet music standards)
					let noteHeadStyle = '';
					if (['C', 'R'].includes(note.symbol)) {
						// Cymbals - X shape (standard cymbal notation)
						noteHeadStyle = 'background: #333; transform: rotate(45deg); width: 12px; height: 12px; border-radius: 0;';
					} else if (['H', 'O', 'P'].includes(note.symbol)) {
						// Hi-hats - triangle pointing down (standard hi-hat notation)
						noteHeadStyle = 'background: #333; clip-path: polygon(50% 100%, 0% 0%, 100% 0%); width: 12px; height: 12px;';
					} else if (['X'].includes(note.symbol)) {
						// Cross stick - diamond (standard cross stick notation)
						noteHeadStyle = 'background: #333; transform: rotate(45deg); width: 12px; height: 12px; border-radius: 0;';
					} else {
						// Regular drums - filled circle (standard drum notation)
						noteHeadStyle = 'background: #333; border-radius: 50%; width: 12px; height: 12px;';
					}
					
					// Note head
					html += `<div style="position: absolute; left: ${left}%; top: ${top}px; ${noteHeadStyle}"></div>`;
					
					// Stem
					html += `<div style="position: absolute; left: ${left + 0.5}%; top: ${top - 10}px; width: 2px; height: 30px; background: #333;"></div>`;
					
					// Drum symbol
					html += `<div style="position: absolute; left: ${left + 2}%; top: ${top - 5}px; font-weight: bold; font-size: 0.8rem; color: #66D37E;">${note.symbol}</div>`;
				});
				
				html += '</div>';
				
				// Add detailed drum notation legend
				html += '<div style="margin-top: 20px; font-size: 11px; text-align: left; background: #f8f9fa; padding: 10px; border-radius: 4px;">';
				html += '<strong>Standard Drum Notation Legend:</strong><br>';
				html += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin-top: 5px;">';
				html += '<div>B = Bass Drum (bottom line) ●</div>';
				html += '<div>S = Snare (middle line) ●</div>';
				html += '<div>H = Hi-Hat (top space) ▼</div>';
				html += '<div>C = Crash (ledger line) ✕</div>';
				html += '<div>R = Ride (top line) ✕</div>';
				html += '<div>T = Tom 1 (2nd space) ●</div>';
				html += '<div>M = Tom 2 (top space) ●</div>';
				html += '<div>F = Floor Tom (2nd line) ●</div>';
				html += '<div>O = Open Hi-Hat (top space) ▼</div>';
				html += '<div>X = Cross Stick (middle line) ◇</div>';
				html += '</div>';
				html += '<div style="margin-top: 5px; font-size: 10px; color: #666;">';
				html += 'Note Head Styles: ● = Drums, ▼ = Hi-Hats, ✕ = Cymbals, ◇ = Cross Stick';
				html += '</div>';
				html += '<div style="margin-top: 5px; font-size: 10px; color: #666;">';
				html += 'Positions follow standard drum notation used in professional sheet music';
				html += '</div>';
				html += '</div>';
				
				html += '</div>';
				html += '</div>';
				
				container.innerHTML = html;
			}
			
			function createDrumNote(symbol, timeValue) {
				const { Vex } = VexFlow;
				
				// Drum note mappings with proper drum notation positions
				const drumNotes = {
					'B': 'F/4', // Bass drum (lowest line)
					'S': 'C/5', // Snare drum (middle line)
					'H': 'G/5', // Hi-hat (top space)
					'C': 'C/6', // Crash cymbal (above staff)
					'R': 'D/5', // Ride cymbal (top line)
					'T': 'E/5', // Tom 1 (second space from top)
					'M': 'F/5', // Tom 2 (top space)
					'F': 'A/4', // Floor tom (second line from bottom)
					'O': 'G/5', // Open hi-hat (top space)
					'X': 'C/5', // Cross stick (middle line)
					'P': 'G/5', // Pedal hi-hat (top space)
					'K': 'F/4'  // Kick (lowest line)
				};
				
				const noteKey = drumNotes[symbol];
				if (!noteKey) return null;
				
				// Create note based on time value
				let note;
				if (timeValue === 1) {
					note = new Vex.Flow.StaveNote({clef: 'percussion', keys: [noteKey], duration: 'q'});
				} else if (timeValue === 0.5) {
					note = new Vex.Flow.StaveNote({clef: 'percussion', keys: [noteKey], duration: '8'});
				} else if (timeValue === 0.25) {
					note = new Vex.Flow.StaveNote({clef: 'percussion', keys: [noteKey], duration: '16'});
				} else if (timeValue === 0.333) {
					note = new Vex.Flow.StaveNote({clef: 'percussion', keys: [noteKey], duration: '8d'});
				} else {
					note = new Vex.Flow.StaveNote({clef: 'percussion', keys: [noteKey], duration: 'q'});
				}
				
				// Set note head styles for different drums
				if (['B', 'K'].includes(symbol)) {
					// Bass drum - filled note head
					note.setNoteHeadType(Vex.Flow.NoteHeadType.NORMAL);
				} else if (['C', 'R'].includes(symbol)) {
					// Cymbals - X note head
					note.setNoteHeadType(Vex.Flow.NoteHeadType.X);
				} else if (['H', 'O', 'P'].includes(symbol)) {
					// Hi-hats - triangle note head
					note.setNoteHeadType(Vex.Flow.NoteHeadType.TRIANGLE_DOWN);
				} else if (['X'].includes(symbol)) {
					// Cross stick - diamond note head
					note.setNoteHeadType(Vex.Flow.NoteHeadType.DIAMOND);
				} else {
					// Regular drums - normal note head
					note.setNoteHeadType(Vex.Flow.NoteHeadType.NORMAL);
				}
				
				// Add stems for all notes
				note.setStemDirection(Vex.Flow.Stem.UP);
				
				return note;
			}
			
			function getTimeValue(divisions, position) {
				if (divisions === 4) return 1; // Quarter notes
				if (divisions === 8) return 0.5; // Eighth notes
				if (divisions === 16) return 0.25; // Sixteenth notes
				if (divisions === 3) return 1; // Quarter notes
				if (divisions === 6) return 0.5; // Eighth notes
				if (divisions === 12) return 0.25; // Sixteenth notes
				return 1; // Default
			}
			
			function getDurationString(timeValue) {
				if (timeValue === 1) return 'q'; // Quarter note
				if (timeValue === 0.5) return '8'; // Eighth note
				if (timeValue === 0.25) return '16'; // Sixteenth note
				if (timeValue === 0.333) return '8d'; // Dotted eighth note
				return 'q'; // Default to quarter note
			}
			
			function addDrumLegend(context, staff) {
				const { Vex } = VexFlow;
				
				// Add legend below the staff
				const legendY = staff.getY() + staff.getHeight() + 30;
				let legendX = staff.getX();
				
				const legendItems = [
					{ symbol: 'B', name: 'Bass Drum', position: 'Bottom Line' },
					{ symbol: 'S', name: 'Snare', position: 'Middle Line' },
					{ symbol: 'H', name: 'Hi-Hat', position: 'Top Space' },
					{ symbol: 'C', name: 'Crash', position: 'Above Staff' },
					{ symbol: 'R', name: 'Ride', position: 'Top Line' },
					{ symbol: 'T', name: 'Tom 1', position: '2nd Space' },
					{ symbol: 'M', name: 'Tom 2', position: 'Top Space' },
					{ symbol: 'F', name: 'Floor Tom', position: '2nd Line' }
				];
				
				legendItems.forEach((item, index) => {
					if (index > 0 && index % 4 === 0) {
						legendX = staff.getX();
						legendY += 20;
					}
					
					const text = new Vex.Flow.TextNote({
						text: `${item.symbol} = ${item.name} (${item.position})`,
						font: { family: 'Arial', size: 9 }
					});
					text.setContext(context);
					text.setPosition(legendX, legendY);
					text.draw();
					
					legendX += 180;
				});
			}
			
			function getNotePosition(symbol) {
				// Standard drum notation positions following real sheet music conventions
				// Based on standard drum notation used in professional music
				const positions = {
					'B': 100, 'K': 100,  // Bass/Kick - bottom line (line 5)
					'S': 60, 'X': 60,    // Snare - middle line (line 3)
					'H': 20, 'O': 20, 'P': 20,  // Hi-hat - top space (space 4)
					'C': -10,            // Crash - above staff (ledger line)
					'R': 40,             // Ride - top line (line 5)
					'T': 80,             // Tom 1 - second space from top (space 3)
					'M': 40,             // Tom 2 - top space (space 4)
					'F': 80              // Floor Tom - second line from bottom (line 2)
				};
				return positions[symbol] || 60;
			}
		});
		
		function downloadSheetMusic() {
			// Create a new window for printing
			const printWindow = window.open('', '_blank');
			printWindow.document.write(`
				<!DOCTYPE html>
				<html>
				<head>
					<title>Drum Sheet Music</title>
					<style>
						body { font-family: Arial, sans-serif; margin: 20px; }
						.sheet-music { text-align: center; margin-bottom: 30px; }
						.vex-staff { margin: 20px 0; }
						@media print {
							body { margin: 0; }
							.sheet-music { page-break-inside: avoid; }
						}
					</style>
				</head>
				<body>
					<h1>Drum Sheet Music</h1>
					<div class="sheet-music">
						${$('#sheet-music-output').html()}
					</div>
				</body>
				</html>
			`);
			printWindow.document.close();
			printWindow.focus();
			
			// Wait for content to load then print
			setTimeout(() => {
				printWindow.print();
			}, 1000);
		}
		
		function printSheetMusic() {
			window.print();
		}
	</script>

	</body>
</html>
